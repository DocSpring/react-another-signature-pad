{"version":3,"sources":["util.js"],"names":["throttle","trim","calculateCurveControlPoints","func","wait","options","all","context","args","result","timeout","previous","opts","later","leading","Date","now","apply","call","remaining","clearTimeout","trailing","setTimeout","canvas","ctx","getContext","copy","document","createElement","pixels","getImageData","width","height","length","data","bound","top","left","right","bottom","i","x","y","Math","floor","trimHeight","trimWidth","trimmed","putImageData","s1","s2","s3","dx1","dy1","dx2","dy2","m1","m2","l1","sqrt","l2","dxm","dym","k","cm","tx","ty","c1","c2"],"mappings":"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","file":"util.js","sourcesContent":["import Point from './point';\r\n\r\n// http://stackoverflow.com/a/27078401/815507\r\nexport function throttle(func, wait, options, ...all) {\r\n  let context;\r\n  let args;\r\n  let result;\r\n  let timeout = null;\r\n  let previous = 0;\r\n  const opts = options || {};\r\n  const later = () => {\r\n    previous = opts.leading === false ? 0 : Date.now();\r\n    timeout = null;\r\n    result = func.apply(context, args);\r\n    if (!timeout) {\r\n      args = null;\r\n      context = args;\r\n    }\r\n  };\r\n  return function call() {\r\n    const now = Date.now();\r\n    if (!previous && opts.leading === false) previous = now;\r\n    const remaining = wait - (now - previous);\r\n    context = this;\r\n    args = all;\r\n    if (remaining <= 0 || remaining > wait) {\r\n      if (timeout) {\r\n        clearTimeout(timeout);\r\n        timeout = null;\r\n      }\r\n      previous = now;\r\n      result = func.apply(context, args);\r\n      if (!timeout) {\r\n        args = null;\r\n        context = args;\r\n      }\r\n    } else if (!timeout && opts.trailing !== false) {\r\n      timeout = setTimeout(later, remaining);\r\n    }\r\n    return result;\r\n  };\r\n}\r\n\r\n// https://gist.github.com/remy/784508\r\n\r\nexport function trim(canvas) {\r\n  const ctx = canvas.getContext('2d');\r\n  const copy = document.createElement('canvas').getContext('2d');\r\n  const pixels = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n  const length = pixels.data.length;\r\n  const bound = {\r\n    top: null,\r\n    left: null,\r\n    right: null,\r\n    bottom: null\r\n  };\r\n  for (let i = 0; i < length; i += 4) {\r\n    if (pixels.data[i + 3] !== 0) {\r\n      const x = (i / 4) % canvas.width;\r\n      const y = Math.floor((i / 4) / canvas.width);\r\n\r\n      if (bound.top === null) {\r\n        bound.top = y;\r\n      }\r\n\r\n      if (bound.left === null) {\r\n        bound.left = x;\r\n      } else if (x < bound.left) {\r\n        bound.left = x;\r\n      }\r\n\r\n      if (bound.right === null) {\r\n        bound.right = x;\r\n      } else if (bound.right < x) {\r\n        bound.right = x;\r\n      }\r\n\r\n      if (bound.bottom === null) {\r\n        bound.bottom = y;\r\n      } else if (bound.bottom < y) {\r\n        bound.bottom = y;\r\n      }\r\n    }\r\n  }\r\n\r\n  const trimHeight = bound.bottom - bound.top;\r\n  const trimWidth = bound.right - bound.left;\r\n  const trimmed = ctx.getImageData(bound.left, bound.top, trimWidth, trimHeight);\r\n\r\n  copy.canvas.width = trimWidth;\r\n  copy.canvas.height = trimHeight;\r\n  copy.putImageData(trimmed, 0, 0);\r\n  return copy.canvas;\r\n}\r\n\r\nexport function calculateCurveControlPoints(s1, s2, s3) {\r\n  const dx1 = s1.x - s2.x;\r\n  const dy1 = s1.y - s2.y;\r\n  const dx2 = s2.x - s3.x;\r\n  const dy2 = s2.y - s3.y;\r\n\r\n  const m1 = { x: (s1.x + s2.x) / 2.0, y: (s1.y + s2.y) / 2.0 };\r\n  const m2 = { x: (s2.x + s3.x) / 2.0, y: (s2.y + s3.y) / 2.0 };\r\n\r\n  const l1 = Math.sqrt((dx1 * dx1) + (dy1 * dy1));\r\n  const l2 = Math.sqrt((dx2 * dx2) + (dy2 * dy2));\r\n\r\n  const dxm = (m1.x - m2.x);\r\n  const dym = (m1.y - m2.y);\r\n\r\n  const k = l2 / (l1 + l2);\r\n  const cm = { x: m2.x + (dxm * k), y: m2.y + (dym * k) };\r\n\r\n  const tx = s2.x - cm.x;\r\n  const ty = s2.y - cm.y;\r\n\r\n  return {\r\n    c1: new Point(m1.x + tx, m1.y + ty),\r\n    c2: new Point(m2.x + tx, m2.y + ty)\r\n  };\r\n}"]}