{"version":3,"sources":["index.js"],"names":["Signature","props","style","width","height","msTouchAction","touchAction","clearVal","handleMouseDown","bind","handleMouseMove","handleMouseUp","handleMouseLeave","handleTouchStart","handleTouchMove","handleTouchEnd","strokeBegin","strokeUpdate","strokeEnd","transformData","createPoint","addPoint","calculateCurveWidths","drawPoint","drawCurve","drawDot","clear","reset","velocityFilterWeight","minWidth","maxWidth","throttle","strokeMoveUpdate","dotSize","penColor","backgroundColor","mimeType","blob","trim","quality","canvas","offsetWidth","offsetHeight","ctx","getContext","nextProps","event","button","mouseButtonDown","targetTouches","length","touch","changedTouches","preventDefault","wasCanvasTouched","target","data","push","onBegin","x","clientX","y","clientY","point","curve","widths","start","end","time","canDrawCurve","points","onEnd","type","String","toLowerCase","toDataURL","byteString","atob","split","mimeString","array","Uint8Array","i","charCodeAt","Blob","rect","getBoundingClientRect","left","top","Date","getTime","tmp","unshift","c2","c3","c1","shift","startPoint","endPoint","velocity","velocityFrom","lastVelocity","newWidth","strokeWidth","lastWidth","Math","max","size","moveTo","arc","PI","onChange","startWidth","endWidth","widthDelta","drawSteps","floor","beginPath","t","tt","ttt","u","uu","uuu","control1","control2","closePath","fill","fillStyle","clearRect","fillRect","className","Component"],"mappings":"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","file":"index.js","sourcesContent":["import React from 'react';\r\nimport Point from './point';\r\nimport Bezier from './bezier';\r\nimport { calculateCurveControlPoints, throttle, trim } from './util';\r\n\r\nclass Signature extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.style = this.props.style || {};\r\n    this.style.width = this.style.width || '100%';\r\n    this.style.height = this.style.height || '100%';\r\n    this.style.msTouchAction = 'none';\r\n    this.style.touchAction = 'none';\r\n    this.clearVal = 0;\r\n\r\n    this.handleMouseDown = this.handleMouseDown.bind(this);\r\n    this.handleMouseMove = this.handleMouseMove.bind(this);\r\n    this.handleMouseUp = this.handleMouseUp.bind(this);\r\n    this.handleMouseLeave = this.handleMouseLeave.bind(this);\r\n    this.handleTouchStart = this.handleTouchStart.bind(this);\r\n    this.handleTouchMove = this.handleTouchMove.bind(this);\r\n    this.handleTouchEnd = this.handleTouchEnd.bind(this);\r\n    this.strokeBegin = this.strokeBegin.bind(this);\r\n    this.strokeUpdate = this.strokeUpdate.bind(this);\r\n    this.strokeEnd = this.strokeEnd.bind(this);\r\n    this.transformData = this.transformData.bind(this);\r\n    this.createPoint = this.createPoint.bind(this);\r\n    this.addPoint = this.addPoint.bind(this);\r\n    this.calculateCurveWidths = this.calculateCurveWidths.bind(this);\r\n    this.drawPoint = this.drawPoint.bind(this);\r\n    this.drawCurve = this.drawCurve.bind(this);\r\n    this.drawDot = this.drawDot.bind(this);\r\n    this.clear = this.clear.bind(this);\r\n    this.reset = this.reset.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.velocityFilterWeight = this.props.velocityFilterWeight || 0.7;\r\n    this.minWidth = this.props.minWidth || 0.5;\r\n    this.maxWidth = this.props.maxWidth || 2.5;\r\n    this.throttle = this.props.throttle || 16; // in miliseconds\r\n    this.strokeMoveUpdate = this.throttle ? throttle(this.strokeUpdate, this.throttle) : this.strokeUpdate;\r\n    this.strokeMoveUpdate = this.strokeUpdate;\r\n    this.dotSize = this.props.dotSize || ((this.minWidth + this.maxWidth) / 2);\r\n    this.penColor = this.props.penColor || 'black';\r\n    this.backgroundColor = this.props.backgroundColor || 'rgba(0,0,0,0)';\r\n    this.mimeType = this.props.mimeType || 'image/png';\r\n    this.blob = this.props.blob || false;\r\n    this.trim = this.props.trim || false;\r\n    this.quality = this.props.quality || 1.0;\r\n\r\n    const canvas = this.canvas;\r\n    canvas.width = canvas.offsetWidth;\r\n    canvas.height = canvas.offsetHeight;\r\n    this.ctx = canvas.getContext('2d');\r\n    this.clear();\r\n  }\r\n  componentWillReceiveProps(nextProps) {\r\n    if (nextProps.clear && nextProps.clear !== this.clearVal) {\r\n      this.clearVal = nextProps.clear;\r\n      this.clear();\r\n    }\r\n  }\r\n\r\n  handleMouseDown(event) {\r\n    if (event.button === 0) {\r\n      this.mouseButtonDown = true;\r\n      this.strokeBegin(event);\r\n    }\r\n  }\r\n\r\n  handleMouseMove(event) {\r\n    if (this.mouseButtonDown) {\r\n      this.strokeMoveUpdate(event);\r\n    }\r\n  }\r\n\r\n  handleMouseUp(event) {\r\n    if (event.button === 0 && this.mouseButtonDown) {\r\n      this.mouseButtonDown = false;\r\n      this.strokeEnd(event);\r\n    }\r\n  }\r\n\r\n  handleMouseLeave(event) {\r\n    if (event.button === 0 && this.mouseButtonDown) {\r\n      this.mouseButtonDown = false;\r\n      this.strokeEnd(event);\r\n    }\r\n  }\r\n\r\n  handleTouchStart(event) {\r\n    if (event.targetTouches.length === 1) {\r\n      const touch = event.changedTouches[0];\r\n      this.strokeBegin(touch);\r\n    }\r\n  }\r\n\r\n  handleTouchMove(event) {\r\n    event.preventDefault();\r\n    const touch = event.targetTouches[0];\r\n    this.strokeMoveUpdate(touch);\r\n  }\r\n\r\n  handleTouchEnd(event) {\r\n    const wasCanvasTouched = event.target === this.canvas;\r\n    if (wasCanvasTouched) {\r\n      event.preventDefault();\r\n      this.strokeEnd(event);\r\n    }\r\n  }\r\n\r\n  strokeBegin(event) {\r\n    this.data.push([]);\r\n    this.reset();\r\n    this.strokeUpdate(event);\r\n\r\n    if (typeof this.props.onBegin === 'function') {\r\n      this.props.onBegin(event);\r\n    }\r\n  }\r\n\r\n  strokeUpdate(event) {\r\n    const x = event.clientX;\r\n    const y = event.clientY;\r\n\r\n    const point = this.createPoint(x, y);\r\n    const { curve, widths } = this.addPoint(point);\r\n\r\n    if (curve && widths) {\r\n      this.drawCurve(curve, widths.start, widths.end);\r\n    }\r\n\r\n    this.data[this.data.length - 1].push({\r\n      x: point.x,\r\n      y: point.y,\r\n      time: point.time\r\n    });\r\n  }\r\n\r\n  strokeEnd() {\r\n    const canDrawCurve = this.points.length > 2;\r\n    const point = this.points[0];\r\n\r\n    if (!canDrawCurve && point) {\r\n      this.drawDot(point);\r\n    }\r\n\r\n    if (typeof this.props.onEnd === 'function') {\r\n      this.props.onEnd(this.transformData());\r\n    }\r\n  }\r\n\r\n  transformData() {\r\n    let type = String(this.mimeType).toLowerCase();\r\n    let data;\r\n    let canvas;\r\n    if (this.trim) {\r\n      canvas = trim(this.canvas);\r\n    } else {\r\n      canvas = this.canvas;\r\n    }\r\n    if (type === 'image/jpeg' || 'image/png') {\r\n      data = canvas.toDataURL(type, this.quality);\r\n    } else {\r\n      type = 'image/png';\r\n      data = canvas.toDataURL(type, this.quality);\r\n    }\r\n    if (this.blob) {\r\n      // Not using toBlob since it's not supported by some browsers\r\n      const byteString = atob(data.split(',')[1]);\r\n      const mimeString = data.split(',')[0].split(':')[1].split(';')[0];\r\n      const array = new Uint8Array(byteString.length);\r\n      for (let i = 0; i < byteString.length; i += 1) {\r\n        array[i] = byteString.charCodeAt(i);\r\n      }\r\n      data = new Blob([array], { type: mimeString });\r\n    }\r\n    return data;\r\n  }\r\n\r\n  createPoint(x, y, time) {\r\n    const rect = this.canvas.getBoundingClientRect();\r\n\r\n    return new Point(\r\n      x - rect.left,\r\n      y - rect.top,\r\n      time || new Date().getTime()\r\n    );\r\n  }\r\n\r\n  addPoint(point) {\r\n    const points = this.points;\r\n    let tmp;\r\n    points.push(point);\r\n    if (points.length > 2) {\r\n      // To reduce the initial lag make it work with 3 points\r\n      // by copying the first point to the beginning.\r\n      if (points.length === 3) points.unshift(points[0]);\r\n      tmp = calculateCurveControlPoints(points[0], points[1], points[2]);\r\n      const c2 = tmp.c2;\r\n      tmp = calculateCurveControlPoints(points[1], points[2], points[3]);\r\n      const c3 = tmp.c1;\r\n      const curve = new Bezier(points[1], c2, c3, points[2]);\r\n      const widths = this.calculateCurveWidths(curve);\r\n      // Remove the first element from the list,\r\n      // so that we always have no more than 4 points in points array.\r\n      points.shift();\r\n      return { curve, widths };\r\n    }\r\n    return {};\r\n  }\r\n\r\n  calculateCurveWidths(curve) {\r\n    const startPoint = curve.startPoint;\r\n    const endPoint = curve.endPoint;\r\n    const widths = { start: null, end: null };\r\n\r\n    const velocity = (this.velocityFilterWeight * endPoint.velocityFrom(startPoint))\r\n      + ((1 - this.velocityFilterWeight) * this.lastVelocity);\r\n\r\n    const newWidth = this.strokeWidth(velocity);\r\n\r\n    widths.start = this.lastWidth;\r\n    widths.end = newWidth;\r\n\r\n    this.lastVelocity = velocity;\r\n    this.lastWidth = newWidth;\r\n\r\n    return widths;\r\n  }\r\n\r\n  strokeWidth(velocity) {\r\n    return Math.max(this.maxWidth / (velocity + 1), this.minWidth);\r\n  }\r\n\r\n  drawPoint(x, y, size) {\r\n    this.ctx.moveTo(x, y);\r\n    this.ctx.arc(x, y, size, 0, 2 * Math.PI, false);\r\n    if (typeof this.props.onChange === 'function') {\r\n      this.props.onChange(false);\r\n    }\r\n  }\r\n\r\n  drawCurve(curve, startWidth, endWidth) {\r\n    const widthDelta = endWidth - startWidth;\r\n    const drawSteps = Math.floor(curve.length());\r\n\r\n    this.ctx.beginPath();\r\n\r\n    for (let i = 0; i < drawSteps; i += 1) {\r\n      // Calculate the Bezier (x, y) coordinate for this step.\r\n      const t = i / drawSteps;\r\n      const tt = t * t;\r\n      const ttt = tt * t;\r\n      const u = 1 - t;\r\n      const uu = u * u;\r\n      const uuu = uu * u;\r\n\r\n      let x = uuu * curve.startPoint.x;\r\n      x += 3 * uu * t * curve.control1.x;\r\n      x += 3 * u * tt * curve.control2.x;\r\n      x += ttt * curve.endPoint.x;\r\n\r\n      let y = uuu * curve.startPoint.y;\r\n      y += 3 * uu * t * curve.control1.y;\r\n      y += 3 * u * tt * curve.control2.y;\r\n      y += ttt * curve.endPoint.y;\r\n\r\n      const width = startWidth + (ttt * widthDelta);\r\n      this.drawPoint(x, y, width);\r\n    }\r\n\r\n    this.ctx.closePath();\r\n    this.ctx.fill();\r\n  }\r\n\r\n  drawDot(point) {\r\n    this.ctx.beginPath();\r\n    this.drawPoint(point.x, point.y, this.dotSize);\r\n    this.ctx.closePath();\r\n    this.ctx.fill();\r\n  }\r\n\r\n  clear() {\r\n    this.ctx.fillStyle = this.backgroundColor;\r\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n    this.data = [];\r\n    this.reset();\r\n    if (typeof this.props.onChange === 'function') {\r\n      this.props.onChange(true);\r\n    }\r\n  }\r\n\r\n  reset() {\r\n    this.points = [];\r\n    this.lastVelocity = 0;\r\n    this.lastWidth = (this.minWidth + this.maxWidth) / 2;\r\n    this.ctx.fillStyle = this.penColor;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <canvas\r\n        style={this.style}\r\n        className={this.props.className}\r\n        ref={(canvas) => { this.canvas = canvas; }}\r\n        onMouseDown={this.handleMouseDown}\r\n        onMouseMove={this.handleMouseMove}\r\n        onMouseUp={this.handleMouseUp}\r\n        onMouseLeave={this.handleMouseLeave}\r\n        onTouchStart={this.handleTouchStart}\r\n        onTouchMove={this.handleTouchMove}\r\n        onTouchEnd={this.handleTouchEnd}\r\n      />\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default Signature;\r\n"]}